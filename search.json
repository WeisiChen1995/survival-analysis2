[
  {
    "objectID": "time-varying.html",
    "href": "time-varying.html",
    "title": "Time-Varying Survival Analysis",
    "section": "",
    "text": "# Load the needed packages\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(survival)\nlibrary(ggsurvfit)\nlibrary(gtsummary)\nlibrary(here)\nlibrary(survminer)\nlibrary(broom)\nlibrary(forestploter)\nlibrary(tidyr)\n\n\n# Load the data"
  },
  {
    "objectID": "fix-time.html",
    "href": "fix-time.html",
    "title": "Fixed Time Survival Analysis",
    "section": "",
    "text": "# Load the needed packages\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(survival)\nlibrary(ggsurvfit)\nlibrary(gtsummary)\nlibrary(here)\nlibrary(survminer)\nlibrary(broom)\nlibrary(forestploter)\nlibrary(tidyr)\n\n\n# Load example data\ndf &lt;- colon\n\nThis analysis focus on survival following the chemotherapy treatment for colon cancer.\n\nAbout the sample data\nThe data come from the colon dataset, available from the survival package. These data include information from a clinical trial on the effectiveness of two different types of chemotherapy (levamisole and levamisole+5-fluorouracil) compared to controls (i.e. no chemotherapy treatment) on survival from stage B/C colon cancer.\nThere are two rows per person in the dataset, one for cancer recurrence and one for death, indicated by the event type (etype) variable (etype==1 corresponds to recurrence and etype==2 to death). In analysis below, I only focus on analysing death as an outcome.\nNote: there is some incomplete values on the differ variable, for simplicity, in the below analysis, I drop those incomplete values.\nSome important variables:\nrx: Treatment - Obs(ervation), Lev(amisole), Lev(amisole)+5-FU  sex: 1=male  age: in years  obstruct: obstruction of colon by tumour  perfor: perforation of colon  adhere: adherence to nearby organs  nodes: number of lymph nodes with detectable cancer  time: days until event or censoring  status: censoring status  differ: differentiation of tumour (1=well, 2=moderate, 3=poor)  extent: Extent of local spread (1=submucosa, 2=muscle, 3=serosa, 4=contiguous structures)  surg: time from surgery to registration (0=short, 1=long)  node4: more than 4 positive lymph nodes  etype: event type: 1=recurrence,2=death \n\n\nData cleaning\n\nFilter records with death outcome\nDrop incomplete values on the diff variable\nLabel the diff and extent variables\nStratify the age variable\n\n\ndf1 &lt;- df %&gt;%\n  filter(etype == 2) %&gt;% # Filter to deaths\n  filter(!is.na(differ)) %&gt;%\n  mutate(\n    differF = factor(differ, levels = 1:3, labels = c(\"well\",\"moderate\",\"poor\")),\n    extentF = factor(extent, levels = 1:4, labels = c(\"submucosa\",\"muscle\",\"serosa\",\"contiguous\")),\n    ageF = factor(ifelse(age&lt;70, 1, 2), levels = 1:2, labels = c('18-69', '70+')),\n    sexF = factor(sex, levels = 0:1, labels = c(\"Female\",\"Male\")),\n    surgF = factor(surg, levels = 0:1, labels = c(\"short\", \"long\"))\n  )\n\n\n\nEDA\n\nTable 1: Summary of demographics and disease status by treatment group\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nObs\nLev\nLev+5FU\nTotal\n\n\n\n\nTotal (column denominator)\n308 (100%)\n300 (100%)\n298 (100%)\n906 (100%)\n\n\nAge\n\n\n\n\n\n\n\n\n\n\n    Mean, (SD)\n59, (12)\n60, (12)\n60, (12)\n60, (12)\n\n\n    Median, (IQR)\n61, (53, 68)\n61, (53, 69)\n62, (52, 70)\n61, (53, 69)\n\n\n    Range\n18, 85\n27, 83\n26, 81\n18, 85\n\n\nSex\n\n\n\n\n\n\n\n\n\n\n    Female\n146 (47%)\n131 (44%)\n161 (54%)\n438 (48%)\n\n\n    Male\n162 (53%)\n169 (56%)\n137 (46%)\n468 (52%)\n\n\nObstruction of colon\n62 (20%)\n59 (20%)\n54 (18%)\n175 (19%)\n\n\nPerforation of colon\n9 (3%)\n10 (3%)\n8 (3%)\n27 (3%)\n\n\nAdherence to nearby organs\n45 (15%)\n47 (16%)\n39 (13%)\n131 (14%)\n\n\nDifferentiation of tumour\n\n\n\n\n\n\n\n\n\n\n    well\n27 (9%)\n37 (12%)\n29 (10%)\n93 (10%)\n\n\n    moderate\n229 (74%)\n219 (73%)\n215 (72%)\n663 (73%)\n\n\n    poor\n52 (17%)\n44 (15%)\n54 (18%)\n150 (17%)\n\n\nExtent of local spread\n\n\n\n\n\n\n\n\n\n\n    submucosa\n7 (2%)\n3 (1%)\n10 (3%)\n20 (2%)\n\n\n    muscle\n36 (12%)\n35 (12%)\n31 (10%)\n102 (11%)\n\n\n    serosa\n248 (81%)\n251 (84%)\n246 (83%)\n745 (82%)\n\n\n    contiguous\n17 (6%)\n11 (4%)\n11 (4%)\n39 (4%)\n\n\nTime until registration\n\n\n\n\n\n\n\n\n\n\n    short\n218 (71%)\n222 (74%)\n222 (74%)\n662 (73%)\n\n\n    long\n90 (29%)\n78 (26%)\n76 (26%)\n244 (27%)\n\n\n&gt;4 positive lymph nodes\n87 (28%)\n87 (29%)\n78 (26%)\n252 (28%)\n\n\nDays until death/censored\n\n\n\n\n\n\n\n\n\n\n    Mean, (SD)\n1,599, (857)\n1,615, (894)\n1,796, (866)\n1,669, (876)\n\n\n    Median, (IQR)\n1,854, (759, 2,274)\n1,910, (741, 2,383)\n2,092, (977, 2,472)\n1,978, (802, 2,375)\n\n\n    Range\n113, 3,214\n24, 3,329\n23, 3,309\n23, 3,329\n\n\nDeath\n165 (54%)\n154 (51%)\n122 (41%)\n441 (49%)\n\n\n\n\n\n\n\n\n\nFigure 1: Kaplan-Meier suvival plots for key predictors\n\n\n\n\n\n\n\n\n\nKey Findings::\nSurvival following treatment for colon cancer was not differentiated by age (p=0.58), sex (p=0.49) or perforation of colon (p=0.56).\nHowever, survival outcomes did differ across the categories of the remaining variables, with better survival rates associated with the Lev+5FU treatment, unobstructed colon, no adherence to nearby organs, well or moderately differentiated tumour, local spread limited to the submucosa or muscle, shorter time until registration and fewer positive lymph nodes.\n\n\n\nTable 2. Hazard ratios and 95% Confidence Intervals for univariable and multivariable Cox regression models\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n\nUnivariable\n\n\nMultivariable\n\n\n\nHR1\n95% CI1\np-value\nHR1\n95% CI1\np-value\n\n\n\n\nTreatment\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    Obs\n—\n—\n\n\n—\n—\n\n\n\n\n    Lev\n0.96\n0.77, 1.19\n0.7\n0.98\n0.79, 1.23\n0.9\n\n\n    Lev+5FU\n0.70\n0.55, 0.88\n0.002\n0.70\n0.55, 0.88\n0.003\n\n\nSex\n1.00\n0.83, 1.21\n&gt;0.9\n\n\n\n\n\n\n\n\nAge (70+ years)\n1.08\n0.87, 1.34\n0.5\n\n\n\n\n\n\n\n\nObstruction of colon\n1.30\n1.03, 1.63\n0.025\n1.29\n1.03, 1.63\n0.028\n\n\nPerforation of colon\n1.17\n0.70, 1.95\n0.6\n\n\n\n\n\n\n\n\nAdherence to nearby organs\n1.35\n1.05, 1.73\n0.018\n1.19\n0.92, 1.53\n0.2\n\n\nDifferentiation of tumour\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    well\n—\n—\n\n\n—\n—\n\n\n\n\n    moderate\n1.05\n0.76, 1.45\n0.8\n0.93\n0.67, 1.29\n0.7\n\n\n    poor\n1.70\n1.18, 2.46\n0.005\n1.36\n0.93, 1.97\n0.11\n\n\nExtent of local spread\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    submucosa\n—\n—\n\n\n—\n—\n\n\n\n\n    muscle\n1.83\n0.65, 5.15\n0.3\n1.34\n0.47, 3.79\n0.6\n\n\n    serosa\n3.25\n1.21, 8.71\n0.019\n2.18\n0.81, 5.87\n0.12\n\n\n    contiguous\n5.04\n1.75, 14.5\n0.003\n3.07\n1.06, 8.94\n0.039\n\n\nTime until registration\n1.26\n1.03, 1.54\n0.027\n1.27\n1.03, 1.56\n0.022\n\n\n&gt;4 positive lymph nodes\n2.58\n2.13, 3.12\n&lt;0.001\n2.49\n2.05, 3.02\n&lt;0.001\n\n\n\n1 HR = Hazard Ratio, CI = Confidence Interval\n\n\n\n\n\n\n\n\nKey Findings:\nThe estimates confirmed that although treatment with levamisole did not improve outcomes compared to the control group (HR = 0.98, 95% CI = 0.79-1.23), the hazard of death was 30% lower among patients treated with levamisole+5-fluorouracil (HR = 0.70, 95% CI = 0.55-0.88). Other factors significantly associated with increased hazard of death included obstruction of the colon (HR = 1.29, 95% CI = 1.03-1.63), local spread to contiguous regions (HR = 3.07, 95% CI = 1.06-8.94), longer time between surgery and registration (HR = 1.27, 95% CI = 1.03-1.56) and more than 4 positive lymph nodes (HR = 2.49, 95% CI = 2.05-3.02).\n\n\nFigure 2: Forest plot for hazard ratios and 95% confidence intervals for multivariable Cox regression models\n\n\n\n\n\n\n\n\n\n\n\nAssessing the proportional harzard assumptions\n\nUsing a chi-squared test based on Schoenfeld residuals:\nH0: Covariate effect is constant (proportional) over time HA: Covariate effect changes over time\nThe null hypothesis of proportional hazard is tested for each covariate individually and jointly as well.\nIf p is &lt;0.05 then there is evidence for violation of the proportional hazards assumption.\n\ncox.zph(cox_model)\n\n#&gt;            chisq df       p\n#&gt; rx        2.3509  2 0.30869\n#&gt; obstruct  6.2760  1 0.01224\n#&gt; adhere    0.0775  1 0.78074\n#&gt; differF  16.0442  2 0.00033\n#&gt; extentF   7.3605  3 0.06125\n#&gt; surg      0.0247  1 0.87521\n#&gt; node4     5.8260  1 0.01579\n#&gt; GLOBAL   36.5773 11 0.00014\n\n\nThe test confirms that the proportional hazards assumption is violated for obstruction of colon (p=0.01), differentiation of tumour (p &lt; 0.001) and marginally for extent of local spread (p=0.06). The test also suggests that the variable indicating more than 4 positive lymph nodes also violates the assumption (p=0.016); the global test also indicates the assumption is invalid (p&lt;0.001).\n\n\nA plot of a smoothed curve over the Schoenfeld residuals\nNote: It is actually plotting the coefficient for each predictor at each time point over time). We want to see a flat line over time.\n(Side note: If we have a large data, we will be able to detect very small changes of coefficients over time. So if the change in the coefficient is not large enough to be clinically meaningfully, it can perhaps be ignored as well).\n\nplot(cox.zph(cox_model))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nDealing with proportional hazards violation as a sensitivity Analysis\n\nStartify by the non-PH variable\nIn the stratified Cox model: - The cox model is estimated separately in each stratum - Drawback: we cannot quantify the effect of the stratification variable on survival (i.e., no coefficient will be estimated).\nBecause these variables are not primary factors of interest we can control for them using stratification. The resulting estimated hazard ratios and 95% confidence intervals are presented in Table 3. As can be seen, the proportional hazards assumption is met in this model.\n\nmvModelStratified &lt;- coxph(Surv(time, status) ~ rx + strata(obstruct) + adhere + strata(differF) + strata(extentF) + surg + strata(node4), data = df1)\n\ncox.zph(mvModelStratified)\n\n#&gt;          chisq df    p\n#&gt; rx     2.24767  2 0.33\n#&gt; adhere 1.50847  1 0.22\n#&gt; surg   0.00211  1 0.96\n#&gt; GLOBAL 3.87358  4 0.42"
  }
]